---
title: "Log4j Investigate"
last_modified_at: 2021-12-14
toc: true
toc_label: ""
tags:
  - Investigation
  - Splunk SOAR
---

[Try in Splunk SOAR](https://www.splunk.com/en_us/software/splunk-security-orchestration-and-automation.html){: .btn .btn--success}

#### Description

Published in response to CVE-2021-44228, this playbook and its sub-playbooks can be used to investigate and respond to attacks against hosts running vulnerable Java applications which use log4j. Between the parent playbook and seven sub-playbooks, each potentially compromised host found in Splunk Enteprise can be investigated and the risk can be mitigated using SSH for unix systems and WinRM for Windows systems.

- **Type**: Investigation
- **Product**: Splunk SOAR
- **Apps**: 
- **Last Updated**: 2021-12-14
- **Author**: Philip Royer, Splunk
- **ID**: e609d729-0076-421a-b8f7-9e545d000381

#### Associated Detections





































































































































































* [Curl Download and Bash Execution](/endpoint/900bc324-59f3-11ec-9fb4-acde48001122/)
































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































* [Wget Download and Bash Execution](/endpoint/35682718-5a85-11ec-b8f7-acde48001122/)


































































































































































































































































































































































































































































































































































































































































































































































































































































































* [Linux Java Spawning Shell](/endpoint/7b09db8a-5c20-11ec-9945-acde48001122/)
























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































* [Java Class File download by Java User Agent](/endpoint/8281ce42-5c50-11ec-82d2-acde48001122/)






































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































* [Outbound Network Connection from Java Using Default Ports](/endpoint/d2c14d28-5c47-11ec-9892-acde48001122/)










































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































* [Log4Shell JNDI Payload Injection Attempt](/web/c184f12e-5c90-11ec-bf1f-497c9a704a72/)






































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































* [Log4Shell JNDI Payload Injection with Outbound Connection](/web/69afee44-5c91-11ec-bf1f-497c9a704a72/)














































































































































































































































































































































































































































































































































































































































































































































































































































































































































* [Detect Outbound LDAP Traffic](/network/5e06e262-d7cd-4216-b2f8-27b437e18458/)












































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































#### How To Implement
To start this playbook, create a custom list called &#34;log4j_hosts&#34; with a format in which the first column should be an IP or hostname of a potentially affected log4j host, the second should be the operating system family (either unix or windows). If the operating system is unknown it can be left blank. In the block called &#34;fetch_hosts_from_custom_list&#34;, change the custom list name from &#34;log4j_hosts&#34; if needed. If the operating system family (&#34;windows&#34; or &#34;unix&#34;) is not known, both ssh and winrm will be attempted. If ssh and/or winrm are not the preferred endpoint management methods, these playbooks could be ported to use Google&#39;s GRR, osquery,  CrowdStrike&#39;s RTR, Carbon Black&#39;s EDR API, or similar tools. The artifact scope &#34;all&#34; is used throughout this playbook because the artifact list can be added to as the playbook progresses.


#### [Explore Playbook](https://splunk.github.io/soar-playbook-viewer/?playbook=https://raw.githubusercontent.com/phantomcyber/playbooks/latest/log4j_investigate.json){: .btn .btn--info}

[![explore](https://raw.githubusercontent.com/splunk/security_content/develop/playbooks/log4j_investigate.png){:height="500px" width="500px"}](https://splunk.github.io/soar-playbook-viewer/?playbook=https://raw.githubusercontent.com/phantomcyber/playbooks/latest/log4j_investigate.json)

#### Required field


#### Reference

* [https://github.com/Neo23x0/Fenrir/blob/master/fenrir.sh](https://github.com/Neo23x0/Fenrir/blob/master/fenrir.sh)
* [https://isc.sans.edu/diary/Log4j++Log4Shell+Followup%3A+What+we+see+and+how+to+defend+%28and+how+to+access+our+data%29/28122](https://isc.sans.edu/diary/Log4j++Log4Shell+Followup%3A+What+we+see+and+how+to+defend+%28and+how+to+access+our+data%29/28122)
* [https://twitter.com/ElektroWolle/status/1469962895849140224?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1469962895849140224%7Ctwgr%5E%7Ctwcon%5Es1_c10&amp;ref_url=https%3A%2F%2Fpublish.twitter.com%2F%3Fquery%3Dhttps3A2F2Ftwitter.com2FElektroWolle2Fstatus2F1469962895849140224widget%3DTweet](https://twitter.com/ElektroWolle/status/1469962895849140224?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1469962895849140224%7Ctwgr%5E%7Ctwcon%5Es1_c10&amp;ref_url=https%3A%2F%2Fpublish.twitter.com%2F%3Fquery%3Dhttps3A2F2Ftwitter.com2FElektroWolle2Fstatus2F1469962895849140224widget%3DTweet)
* [https://blog.cloudflare.com/cve-2021-44228-log4j-rce-0-day-mitigation/](https://blog.cloudflare.com/cve-2021-44228-log4j-rce-0-day-mitigation/)




[*source*](https://github.com/splunk/security_content/tree/develop/playbooks/log4j_investigate.yml) \| *version*: **2**