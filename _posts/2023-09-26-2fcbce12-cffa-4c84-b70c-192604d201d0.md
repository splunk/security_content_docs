---
title: "PingID New MFA Method After Credential Reset"
excerpt: "Multi-Factor Authentication Request Generation, Multi-Factor Authentication, Device Registration"
categories:
  - Application
last_modified_at: 2023-09-26
toc: true
toc_label: ""
tags:
  - Multi-Factor Authentication Request Generation
  - Credential Access
  - Multi-Factor Authentication
  - Credential Access
  - Defense Evasion
  - Persistence
  - Device Registration
  - Persistence
  - Privilege Escalation
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  - Change
redirect_from: application/pingid_new_mfa_method_after_credential_reset/
---



[Try in Splunk Security Cloud](https://www.splunk.com/en_us/cyber-security.html){: .btn .btn--success}

#### Description

A common social engineering technique used by threat actors is the impersonation of a valid user to organizational support staff for a password reset. During the same support call or quickly afterwards the threat actor will request provisioning of a new MFA device. This does not require malware or phishing infrastructure and has proven to be successful in numerous historical attacks. This detection looks for the pattern of password reset, followed by MFA device provisioning.

- **Type**: [TTP](https://github.com/splunk/security_content/wiki/Detection-Analytic-Types)
- **Product**: Splunk Enterprise, Splunk Enterprise Security, Splunk Cloud
- **Datamodel**: [Change](https://docs.splunk.com/Documentation/CIM/latest/User/Change)
- **Last Updated**: 2023-09-26
- **Author**: Steven Dick
- **ID**: 2fcbce12-cffa-4c84-b70c-192604d201d0

### Annotations
<details>
  <summary>ATT&CK</summary>

<div markdown="1">

#### [ATT&CK](https://attack.mitre.org/)

| ID          | Technique   | Tactic         |
| ----------- | ----------- |--------------- |
| [T1621](https://attack.mitre.org/techniques/T1621/) | Multi-Factor Authentication Request Generation | Credential Access |

| [T1556.006](https://attack.mitre.org/techniques/T1556/006/) | Multi-Factor Authentication | Credential Access, Defense Evasion, Persistence |

| [T1098.005](https://attack.mitre.org/techniques/T1098/005/) | Device Registration | Persistence, Privilege Escalation |

</div>
</details>


<details>
  <summary>Kill Chain Phase</summary>

<div markdown="1">

* Exploitation
* Installation


</div>
</details>


<details>
  <summary>NIST</summary>

<div markdown="1">

* DE.CM



</div>
</details>

<details>
  <summary>CIS20</summary>

<div markdown="1">

* CIS 10



</div>
</details>

<details>
  <summary>CVE</summary>

<div markdown="1">


</div>
</details>


#### Search

```
`pingid` "result.message" = "*Device Paired*" 
| rex field=result.message "Device (Unp)?(P)?aired (?<device_extract>.+)" 
| eval src = coalesce('resources{}.ipaddress','resources{}.devicemodel'), user = upper('actors{}.name'), reason = 'result.message' 
| eval object=CASE(ISNOTNULL('resources{}.devicemodel'),'resources{}.devicemodel',true(),device_extract) 
| eval action=CASE(match('result.message',"Device Paired*"),"created",match('result.message', "Device Unpaired*"),"deleted") 
| stats count min(_time) as firstTime, max(_time) as lastTime, values(reason) as reason by src,user,action,object 
| join type=outer user [
| search `wineventlog_security` EventID IN(4723,4724) 
| eval PW_Change_Time = _time, user = upper(user) 
| fields user,src_user,EventID,PW_Change_Time] 
| eval timeDiffRaw = round(lastTime - PW_Change_Time) 
| eval timeDiff = replace(tostring(abs(timeDiffRaw) ,"duration"),"(\d*)\+*(\d+):(\d+):(\d+)","\2 hours \3 minutes") 
| `security_content_ctime(firstTime)` 
| `security_content_ctime(lastTime)` 
| `security_content_ctime(PW_Change_Time)` 
| where timeDiffRaw > 0 AND timeDiffRaw < 3600 
| `pingid_new_mfa_method_after_credential_reset_filter`
```

#### Macros
The SPL above uses the following Macros:
* [pingid](https://github.com/splunk/security_content/blob/develop/macros/pingid.yml)
* [security_content_ctime](https://github.com/splunk/security_content/blob/develop/macros/security_content_ctime.yml)
* [wineventlog_security](https://github.com/splunk/security_content/blob/develop/macros/wineventlog_security.yml)

> :information_source:
> **pingid_new_mfa_method_after_credential_reset_filter** is a empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.



#### Required fields
List of fields required to use this analytic.
* _time
* user
* src_user
* src
* EventID
* resources{}.ipaddress
* actors{}.name
* result.message
* resources{}.devicemodel



#### How To Implement
Target environment must ingest Windows Event Log and PingID(PingOne) data sources. Specifically from logs from Active Directory Domain Controllers and JSON logging from a PingID(PingOne) enterprise environment, either via Webhook or Push Subscription.
#### Known False Positives
False positives may be generated by normal provisioning workflows that generate a password reset followed by a device registration.

#### Associated Analytic Story
* [Compromised User Account](/stories/compromised_user_account)




#### RBA

| Risk Score  | Impact      | Confidence   | Message      |
| ----------- | ----------- |--------------|--------------|
| 50.0 | 100 | 50 | An MFA configuration change was detected for [$user$] within [$timeDiff$] of a password reset. The device [$object$] was $action$. |


> :information_source:
> The Risk Score is calculated by the following formula: Risk Score = (Impact * Confidence/100). Initial Confidence and Impact is set by the analytic author.


#### Reference

* [https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/defend-your-users-from-mfa-fatigue-attacks/ba-p/2365677](https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/defend-your-users-from-mfa-fatigue-attacks/ba-p/2365677)
* [https://www.bleepingcomputer.com/news/security/mfa-fatigue-hackers-new-favorite-tactic-in-high-profile-breaches/](https://www.bleepingcomputer.com/news/security/mfa-fatigue-hackers-new-favorite-tactic-in-high-profile-breaches/)
* [https://attack.mitre.org/techniques/T1098/005/](https://attack.mitre.org/techniques/T1098/005/)
* [https://attack.mitre.org/techniques/T1556/006/](https://attack.mitre.org/techniques/T1556/006/)
* [https://docs.pingidentity.com/r/en-us/pingoneforenterprise/p14e_subscriptions?tocId=3xhnxjX3VzKNs3SXigWnQA](https://docs.pingidentity.com/r/en-us/pingoneforenterprise/p14e_subscriptions?tocId=3xhnxjX3VzKNs3SXigWnQA)



#### Test Dataset
Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)




[*source*](https://github.com/splunk/security_content/tree/develop/detections/application/pingid_new_mfa_method_after_credential_reset.yml) \| *version*: **1**